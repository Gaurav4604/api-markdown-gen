import ollama
import yaml

yml = yaml.safe_load(open("yml/marine_weather_api.yml"))


def document_dump_prompt(doc, question, helper):
    prompt = """
<document> 
    {}
</document> 
Provided above, is a document
the following is some helper context info,
which provides the API endpoint for the document and target the location provided in the question
<helper-context>
    {}
</helper-context>

Question: {}
    """.format(
        doc, helper, question
    )
    return prompt


import frontmatter


helper = """
<api-info>
 {}
</api-info>
<latitude-longitude>
{}
<latitude-longitude>
""".format(
    "https://marine-api.open-meteo.com/v1/marine", [-34.92, 138.60]
)

question = "what kind of waves is adelaide experiencing now?"

system = """
You are not an AI assistant, you are a API endpoint generator,
You are supposed to look at the document's API parameters, and 
respond to user's question, by generating a REST API endpoint, that satisfies
user's question
NOTE: unless the parameters are specified in the query URL
their return values are not considered to generate a response,
so include the parameters responsible according to the question
"""


res = ollama.chat(
    model="marco-o1",
    messages=[
        # {"role": "system", "content": system},
        {
            "role": "user",
            # "content": document_dump_prompt(yml, question, helper),
            "content": """
            Assess this response:
            {"latitude":-35.25,"longitude":138.25,"generationtime_ms":0.4140138626098633,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":0.0,"hourly_units":{"time":"iso8601","wave_height":"m","wind_wave_height":"m","swell_wave_height":"m","wave_direction":"°","wind_wave_direction":"°","swell_wave_direction":"°"},"hourly":{"time":["2025-01-06T00:00","2025-01-06T01:00","2025-01-06T02:00","2025-01-06T03:00","2025-01-06T04:00","2025-01-06T05:00","2025-01-06T06:00","2025-01-06T07:00","2025-01-06T08:00","2025-01-06T09:00","2025-01-06T10:00","2025-01-06T11:00","2025-01-06T12:00","2025-01-06T13:00","2025-01-06T14:00","2025-01-06T15:00","2025-01-06T16:00","2025-01-06T17:00","2025-01-06T18:00","2025-01-06T19:00","2025-01-06T20:00","2025-01-06T21:00","2025-01-06T22:00","2025-01-06T23:00","2025-01-07T00:00","2025-01-07T01:00","2025-01-07T02:00","2025-01-07T03:00","2025-01-07T04:00","2025-01-07T05:00","2025-01-07T06:00","2025-01-07T07:00","2025-01-07T08:00","2025-01-07T09:00","2025-01-07T10:00","2025-01-07T11:00","2025-01-07T12:00","2025-01-07T13:00","2025-01-07T14:00","2025-01-07T15:00","2025-01-07T16:00","2025-01-07T17:00","2025-01-07T18:00","2025-01-07T19:00","2025-01-07T20:00","2025-01-07T21:00","2025-01-07T22:00","2025-01-07T23:00","2025-01-08T00:00","2025-01-08T01:00","2025-01-08T02:00","2025-01-08T03:00","2025-01-08T04:00","2025-01-08T05:00","2025-01-08T06:00","2025-01-08T07:00","2025-01-08T08:00","2025-01-08T09:00","2025-01-08T10:00","2025-01-08T11:00","2025-01-08T12:00","2025-01-08T13:00","2025-01-08T14:00","2025-01-08T15:00","2025-01-08T16:00","2025-01-08T17:00","2025-01-08T18:00","2025-01-08T19:00","2025-01-08T20:00","2025-01-08T21:00","2025-01-08T22:00","2025-01-08T23:00","2025-01-09T00:00","2025-01-09T01:00","2025-01-09T02:00","2025-01-09T03:00","2025-01-09T04:00","2025-01-09T05:00","2025-01-09T06:00","2025-01-09T07:00","2025-01-09T08:00","2025-01-09T09:00","2025-01-09T10:00","2025-01-09T11:00","2025-01-09T12:00","2025-01-09T13:00","2025-01-09T14:00","2025-01-09T15:00","2025-01-09T16:00","2025-01-09T17:00","2025-01-09T18:00","2025-01-09T19:00","2025-01-09T20:00","2025-01-09T21:00","2025-01-09T22:00","2025-01-09T23:00","2025-01-10T00:00","2025-01-10T01:00","2025-01-10T02:00","2025-01-10T03:00","2025-01-10T04:00","2025-01-10T05:00","2025-01-10T06:00","2025-01-10T07:00","2025-01-10T08:00","2025-01-10T09:00","2025-01-10T10:00","2025-01-10T11:00","2025-01-10T12:00","2025-01-10T13:00","2025-01-10T14:00","2025-01-10T15:00","2025-01-10T16:00","2025-01-10T17:00","2025-01-10T18:00","2025-01-10T19:00","2025-01-10T20:00","2025-01-10T21:00","2025-01-10T22:00","2025-01-10T23:00","2025-01-11T00:00","2025-01-11T01:00","2025-01-11T02:00","2025-01-11T03:00","2025-01-11T04:00","2025-01-11T05:00","2025-01-11T06:00","2025-01-11T07:00","2025-01-11T08:00","2025-01-11T09:00","2025-01-11T10:00","2025-01-11T11:00","2025-01-11T12:00","2025-01-11T13:00","2025-01-11T14:00","2025-01-11T15:00","2025-01-11T16:00","2025-01-11T17:00","2025-01-11T18:00","2025-01-11T19:00","2025-01-11T20:00","2025-01-11T21:00","2025-01-11T22:00","2025-01-11T23:00","2025-01-12T00:00","2025-01-12T01:00","2025-01-12T02:00","2025-01-12T03:00","2025-01-12T04:00","2025-01-12T05:00","2025-01-12T06:00","2025-01-12T07:00","2025-01-12T08:00","2025-01-12T09:00","2025-01-12T10:00","2025-01-12T11:00","2025-01-12T12:00","2025-01-12T13:00","2025-01-12T14:00","2025-01-12T15:00","2025-01-12T16:00","2025-01-12T17:00","2025-01-12T18:00","2025-01-12T19:00","2025-01-12T20:00","2025-01-12T21:00","2025-01-12T22:00","2025-01-12T23:00"],"wave_height":[0.88,0.90,0.90,0.92,0.92,0.94,0.94,0.94,0.92,0.92,0.90,0.90,0.88,0.86,0.84,0.82,0.78,0.76,0.72,0.68,0.62,0.58,0.54,0.50,0.46,0.44,0.44,0.42,0.44,0.48,0.50,0.52,0.54,0.56,0.52,0.50,0.46,0.42,0.38,0.34,0.32,0.28,0.26,0.24,0.24,0.22,0.22,0.22,0.22,0.22,0.20,0.20,0.20,0.20,0.20,0.22,0.24,0.26,0.24,0.22,0.20,0.20,0.18,0.18,0.18,0.18,0.18,0.20,0.20,0.22,0.22,0.20,0.20,0.20,0.22,0.22,0.28,0.32,0.38,0.38,0.40,0.40,0.38,0.38,0.36,0.34,0.30,0.28,0.28,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.26,0.30,0.34,0.38,0.42,0.44,0.48,0.46,0.46,0.44,0.42,0.42,0.40,0.38,0.38,0.36,0.34,0.32,0.30,0.28,0.28,0.26,0.28,0.28,0.30,0.32,0.34,0.36,0.42,0.50,0.56,0.56,0.58,0.58,0.56,0.56,0.54,0.54,0.52,0.52,0.52,0.50,0.50,0.50,0.48,0.48,0.48,0.48,0.48,0.48,0.48,0.48,0.52,0.54,0.58,0.60,0.64,0.66,0.66,0.64,0.64,0.64,0.62,0.62,0.60,0.60,0.58,0.58,0.56,0.56,0.56,0.56],"wind_wave_height":[0.66,0.70,0.72,0.76,0.76,0.74,0.74,0.74,0.74,0.74,0.72,0.70,0.68,0.66,0.64,0.62,0.60,0.58,0.56,0.52,0.46,0.42,0.38,0.32,0.28,0.28,0.28,0.28,0.32,0.38,0.42,0.44,0.44,0.46,0.36,0.24,0.14,0.10,0.04,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.02,0.02,0.04,0.06,0.08,0.06,0.06,0.04,0.04,0.02,0.02,0.02,0.04,0.04,0.04,0.06,0.06,0.08,0.12,0.14,0.10,0.04,0.00,0.06,0.10,0.16,0.22,0.26,0.32,0.30,0.30,0.28,0.26,0.22,0.20,0.18,0.14,0.12,0.12,0.12,0.12,0.10,0.10,0.08,0.10,0.10,0.12,0.20,0.26,0.34,0.36,0.40,0.42,0.38,0.32,0.28,0.26,0.24,0.22,0.18,0.12,0.08,0.06,0.02,0.00,0.02,0.02,0.04,0.04,0.04,0.04,0.10,0.16,0.22,0.30,0.38,0.46,0.42,0.40,0.36,0.32,0.26,0.22,0.18,0.12,0.08,0.08,0.08,0.08,0.06,0.06,0.04,0.04,0.04,0.04,0.08,0.14,0.18,0.26,0.32,0.40,0.40,0.42,0.42,0.40,0.40,0.38,0.36,0.36,0.34,0.32,0.28,0.26,0.26,0.26,0.26,0.26,0.26],"swell_wave_height":[0.42,0.42,0.40,0.40,0.40,0.42,0.42,0.42,0.40,0.40,0.40,0.40,0.40,0.38,0.38,0.36,0.36,0.34,0.34,0.34,0.32,0.32,0.32,0.30,0.30,0.30,0.28,0.28,0.28,0.26,0.26,0.26,0.26,0.26,0.28,0.30,0.32,0.30,0.28,0.26,0.24,0.24,0.22,0.22,0.20,0.20,0.20,0.20,0.20,0.20,0.18,0.18,0.18,0.16,0.16,0.16,0.16,0.16,0.16,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.14,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.12,0.14,0.18,0.20,0.22,0.24,0.26,0.24,0.24,0.22,0.20,0.16,0.14,0.14,0.14,0.14,0.14,0.12,0.12,0.12,0.14,0.14,0.14,0.14,0.14,0.14,0.16,0.16,0.16,0.18,0.18,0.18,0.18,0.18,0.16,0.16,0.14,0.14,0.16,0.16,0.16,0.14,0.14,0.16,0.20,0.22,0.26,0.28,0.32,0.34,0.34,0.36,0.38,0.38,0.40,0.40,0.42,0.42,0.42,0.44,0.44,0.44,0.46,0.46,0.46,0.44,0.44,0.44,0.44,0.44,0.44,0.42,0.42,0.42,0.42,0.42,0.42,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40,0.40],"wave_direction":[204,202,201,199,198,196,195,194,192,191,191,190,190,188,186,184,181,177,174,175,175,176,180,185,189,191,194,196,193,190,187,184,181,178,182,186,190,198,206,214,218,222,226,228,229,231,232,232,233,234,234,235,235,236,236,235,233,232,232,233,233,233,234,234,233,232,231,221,211,201,203,206,208,213,219,224,219,215,210,207,204,201,200,199,198,201,205,208,211,215,218,220,221,223,223,222,222,222,221,221,221,221,221,220,219,218,217,216,215,217,218,220,222,225,227,229,232,234,235,235,236,236,236,236,234,233,231,230,229,228,229,229,230,232,233,235,236,238,239,240,240,241,241,242,242,241,240,239,234,228,223,220,217,214,213,211,210,211,211,212,214,215,217,218,219,220,220,220],"wind_wave_direction":[185,184,182,181,179,177,175,174,172,171,170,168,167,163,158,154,148,143,137,134,131,128,127,127,126,133,139,146,150,155,159,156,154,151,150,149,148,147,146,145,138,132,125,109,93,77,42,8,333,305,278,250,241,231,222,210,198,186,163,141,118,122,126,130,132,133,135,138,141,144,150,156,162,179,196,213,208,204,199,190,182,173,169,166,162,163,164,165,167,168,170,173,176,179,182,185,188,197,207,216,216,215,215,206,196,187,183,179,175,165,154,144,152,160,168,172,177,181,202,222,243,238,232,227,226,224,223,213,204,194,188,182,176,161,147,132,136,139,143,148,154,159,161,162,164,169,173,178,180,183,185,180,176,171,166,160,155,154,154,153,154,155,156,159,161,164,164,164],"swell_wave_direction":[230,229,227,226,227,228,229,228,227,226,225,225,224,226,227,229,227,226,224,231,237,244,244,243,243,243,242,242,242,242,242,242,242,242,232,221,211,212,214,215,224,233,242,242,243,243,243,243,243,243,244,244,244,245,245,238,231,224,231,238,245,245,245,245,245,244,244,243,242,241,241,241,241,241,241,241,241,241,241,236,230,225,219,212,206,204,203,201,211,221,231,236,240,245,245,245,245,245,245,245,245,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,245,245,245,244,244,244,244,244,244,244,244,244,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245]}}
            for the query response, and answer my question: 
            """
            + question,
        },
    ],
    options={"temperature": 0.1, "num_ctx": 16384},
)

print(res["message"]["content"])
import json

print(json.dumps(res.model_dump(), indent=2))
